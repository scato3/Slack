(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[256],{5256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var n=a(2309),l=a(2545),s=a(9250),o=a(8678),r=a(2951),c=a(7753);const i=(0,c.Z)("div",{target:"enhg4lt2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),h=(0,c.Z)("header",{target:"enhg4lt1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),p=(0,c.Z)("div",{target:"enhg4lt0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var u=a(3564),d=a(8667),g=a(9669),f=a.n(g),m=a(7294),w=a(5977),b=a(8100);const k=()=>{const{workspace:e,channel:t}=(0,w.UO)(),{data:a}=(0,b.ZP)("/api/users",u.Z),[c,g,k]=(0,o.Z)(""),{data:v}=(0,b.ZP)(`/api/workspaces/${e}/channels/${t}`,u.Z),{data:x,mutate:C,revalidate:Z,setSize:_}=(0,b.g_)((a=>`/api/workspaces/${e}/channels/${t}/chats?perPage=20&page=${a+1}`),u.Z),{data:E}=(0,b.ZP)(a?`/api/workspaces/${e}/channels/${t}/members`:null,u.Z),[T]=(0,r.Z)(e),$=0===x?.[0]?.length||x&&x[x.length-1]?.length<20||!1,y=(0,m.useRef)(null),[S,D]=(0,m.useState)(!1),[z,B]=(0,m.useState)(!1),F=(0,m.useCallback)((n=>{if(n.preventDefault(),console.log(c),c?.trim()&&x&&v){const n=c;C((e=>(e?.[0].unshift({id:(x[0][0]?.id||0)+1,content:n,UserId:a.id,User:a,ChannelId:v.id,Channel:v,createdAt:new Date}),e)),!1).then((()=>{k(""),y.current?.scrollToBottom()})),f().post(`/api/workspaces/${e}/channels/${t}/chats`,{content:c}).then((()=>{Z()})).catch(console.error)}}),[c,x,a,v,e,t]),A=(0,m.useCallback)((e=>{e.Channel.name!==t||!e.content.startsWith("uploads\\")&&e.UserId===a?.id||C((t=>(t?.[0].unshift(e),t)),!1).then((()=>{y.current&&y.current.getScrollHeight()<y.current.getClientHeight()+y.current.getScrollTop()+150&&(console.log("scrollToBottom!",y.current?.getValues()),setTimeout((()=>{y.current?.scrollToBottom()}),50))}))}),[t,a]);(0,m.useEffect)((()=>(T?.on("message",A),()=>{T?.off("message",A)})),[T,A]),(0,m.useEffect)((()=>{1===x?.length&&(console.log("toBottomWhenLoaded",y.current),setTimeout((()=>{console.log("scrollbar",y.current),y.current?.scrollToBottom()}),500))}),[x]);const I=(0,m.useCallback)((()=>{D(!0)}),[]),P=(0,m.useCallback)((()=>{D(!1)}),[]),U=((0,m.useCallback)((a=>{const n=new FormData;if(a.target.files)for(let e=0;e<a.target.files.length;e++){const t=a.target.files[e].getAsFile();console.log("... file["+e+"].name = "+t.name),n.append("image",t)}f().post(`/api/workspaces/${e}/channels/${t}/images`,n).then((()=>{}))}),[]),(0,m.useCallback)((a=>{a.preventDefault(),console.log(a);const n=new FormData;if(a.dataTransfer.items){for(let e=0;e<a.dataTransfer.items.length;e++)if("file"===a.dataTransfer.items[e].kind){const t=a.dataTransfer.items[e].getAsFile();console.log(a,".... file["+e+"].name = "+t.name),n.append("image",t)}}else for(let e=0;e<a.dataTransfer.files.length;e++)console.log(a,"... file["+e+"].name = "+a.dataTransfer.files[e].name),n.append("image",a.dataTransfer.files[e]);f().post(`/api/workspaces/${e}/channels/${t}/images`,n).then((()=>{B(!1)}))}),[e,t])),j=(0,m.useCallback)((e=>{e.preventDefault(),console.log(e),B(!0)}),[]);if(!a||!a)return null;const N=(0,d.Z)(x?x.flat().reverse():[]);return m.createElement(i,{onDrop:U,onDragOver:j},m.createElement(h,null,m.createElement("span",null,"#",t),m.createElement("div",{className:"header-right"},m.createElement("span",null,E?.length),m.createElement("button",{onClick:I,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(l.Z,{chatSections:N,ref:y,setSize:_,isReachingEnd:$}),m.createElement(n.Z,{chat:c,onChangeChat:g,onSubmitForm:F}),m.createElement(s.Z,{show:S,onCloseModal:P,setShowInviteChannelModal:D}),z&&m.createElement(p,null,"업로드!"))}}}]);